<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>base</title>
<link rel="stylesheet" href="../vendor/qunit/qunit.css">
</head>
<body>
  <h1 id="qunit-header">QUnit Test Suite</h1>
  <h2 id="qunit-banner"></h2>
  <div id="qunit-testrunner-toolbar"></div>
  <h2 id="qunit-userAgent"></h2>
  <ol id="qunit-tests"></ol>
  <div id="qunit-fixture">test markup</div>
  <script src="../vendor/jquery/jquery.js"></script>
  <script src="../vendor/seajs/sea.js"></script>
  <script src="../vendor/qunit/qunit.js"></script>
  <script>
    QUnit.config.autostart = false;

    seajs.config({
        'base': '../sea-modules/',
        'map': [
            ['/sea-modules/jquery', '/vendor/jquery/jquery']
        ],
        'alias': {
          '$': 'jquery',
          'base': 'pandora/base/1.0.0/base'
        }
    });

    seajs.use(['base'], function (Base) {

      QUnit.start();

      test('new', function() {
        notEqual( new Base(), new Base(), 'new' );
      });

      test('constructor', function() {
        var BaseA = Base.extend();
        var baseA = new BaseA();
        equal( baseA.constructor, BaseA, 'constructor' );
        notEqual( baseA.constructor, Base, 'constructor' );
      });

      test('instanceof', function() {
        var BaseA = Base.extend();
        var baseA = new BaseA();
        ok( baseA instanceof BaseA, 'instanceof' );
        ok( baseA instanceof Base, 'instanceof' );
      });

      test('extend', function() {
        var BaseA = Base.extend({
          world: 'earth',
          hello: function () {
            return 'hello ' + this.world;
          }
        });
        var baseA = new BaseA();
        equal( baseA.world, 'earth', '' );
        equal( baseA.hello(), 'hello earth', '' );
      });

      test('setup', function() {
        var BaseA = Base.extend({
          setup: function () {
            this.x = this.option('x');
          }
        });
        var baseA = new BaseA({
          x: 2,
          y: 3
        });
        equal( baseA.x, 2, '' );
        equal( baseA.y, undefined, '' );
      });

      test('render', function() {
        var BaseA = Base.extend({
        });
        var baseA = new BaseA({
        });
        baseA.render();
        baseA.render();
        equal( $('.ue-component').length, 1, '' );
        // for next tests
        baseA.destroy();
      });

      test('$', function() {
        var BaseA = Base.extend({
          setup: function () {
            this.render();
            this.element.html('<p>123</p>');
          }
        });
        var baseA = new BaseA();
        equal( baseA.$('p').length, 1, '' );
        // for next tests
        baseA.destroy();
      });

      test('destroy', function() {
        var BaseA = Base.extend({
        });
        var baseA = new BaseA({
        });
        baseA.render();
        baseA.destroy();
        baseA.destroy();
        equal( baseA.element, undefined, '' );
        equal( $('.ue-component').length, 0, '' );
      });

      test('state', function() {
        var BaseA = Base.extend({
        });
        var baseA = new BaseA({
        });
        equal( baseA.state(), undefined, '' );
        baseA.state(1);
        equal( baseA.state(), 1, '' );
      });

      test('option', function() {
        var BaseA = Base.extend({
          defaults: {
            y: 5,
            z: 4
          }
        });
        var events = {
          a: function () {
          },
          b: function () {
          }
        };
        var baseA = new BaseA({
          x: 2,
          y: 3,
          z: 4,
          events: events
        });
        deepEqual( baseA.option(), {
          container: 'body',
          element: '<div class="ue-component"></div>',
          x: 2,
          y: 3,
          z: 4,
          events: events
        }, '' );
        equal( baseA.option('y'), 3, '' );
        equal( baseA.option('w'), undefined, '' );
        deepEqual( baseA.option('events'), events, '' );
      });

      test('data', function() {
        var BaseA = Base.extend({
        });
        var baseA = new BaseA({
        });
        deepEqual( baseA.data(), {}, '' );
        equal( baseA.data('a', '1'), baseA, '' );
        equal( baseA.data('a'), '1', '' );
        equal( baseA.data('hasOwnProperty'), undefined, 'built-in property returns undefined' );
        equal( baseA.data('b'), undefined, '' );
        equal( baseA.data({b: '2'}), baseA, '' );
        deepEqual( baseA.data(), {a: '1', b: '2'}, '' );
      });

      test('delegate', function() {
        var BaseA = Base.extend({
          setup: function () {
            this.render();
          }
        });
        var baseA = new BaseA({
          element: '<div></div>',
          delegates: {
            'click': function (e) {
              ok( true, 'clicked' );
            }
          }
        });
        baseA.element.click();
        baseA.destroy();
      });

      test('delegate', function() {
        var BaseA = Base.extend({
          setup: function () {
            this.render();
          }
        });
        var baseA = new BaseA({
          element: '<div><button>button</button></div>',
          delegates: function () {
            var delegates = {
              'click button': function (e) {
                ok( true, 'clicked' );
              }
            };
            return delegates;
          }
        });
        baseA.element.find('button').click();
        baseA.destroy();
      });

      test('events', function() {
        var base = new Base({
          events: {
            test: function (e, t) {
              this.t = t;
              this.e = e;
            }
          }
        });
        base.fire('test', '2');
        equal( base.e, 'test', '' );
        equal( base.t, '2', '' );
        base.off('test');
        base.fire('test', '4');
        equal( base.t, '2', '' );
      });

      test('AOP', function() {
        var BaseA = Base.extend({
          hello: function () {
            return 'hello ' + this.data('world');
          }
        });
        var baseA = new BaseA({
          events: {
            'before:hello': function () {
              if (this.data('world') === 'mars') {
                return false;
              }
              this.data('world', 'mars');
              ok( true, 'before called');
            },
            'after:hello': function (e, result) {
              ok( true, 'after called');
            },
            'after:hello2': function (e, result) {
            }
          },
          world: 'earth'
        });
        equal( baseA.hello(), 'hello mars', 'method called' );
        equal( baseA.hello(), undefined, 'prevented' );
      });

    });
  </script>
</body>
</html>
